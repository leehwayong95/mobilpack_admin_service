<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.mobilpack.manager.Dao.Dao">
	<!-- 추천 장소 관리 쿼리 -->
	<!-- 게시글 등록 쿼리  -->
	<insert id="RecommandCreate" parameterType="com.mobilpack.manager.Model.PostModel" useGeneratedKeys="true" keyProperty="postindex">
		INSERT INTO recommended_place(default_lang,category,title,admin_id,content,tag,voice_info,location,address,phone,state,openday,opentime,closetime,endtime)
		VALUES('${default_lang}','${category}','${title}','${admin_id}','${content}','${tag}','${voice_info}','${location}','${address}','${phone}','${state}','${openday}','${opentime}','${closetime}','${endtime}')
	</insert>
	<insert id="FileCreate" parameterType="com.mobilpack.manager.Model.FileModel">
		INSERT INTO recommend_files(postindex,filename,fileuuid,filepath)
		VALUES('${postindex}','${filename}','${fileuuid}','${filepath}')
	</insert>
	<!-- 게시글 검색 및 리스트 출력 쿼리 -->
	<select id="RecommandList" parameterType="String" resultType="com.mobilpack.manager.Model.PostModel">
		SELECT r.tag, r.postindex,r.category, r.language, r.default_lang, r.title, r.date, r.state, p.name, c.count
			FROM recommended_place r 
		LEFT OUTER JOIN admin p
			ON r.admin_id = p.admin_id
		LEFT OUTER JOIN (SELECT postindex,COUNT(*) AS count FROM comments GROUP BY postindex)AS c
			ON r.postindex = c.postindex
		<where>
		<!-- 언어를 고른 경우 -->
			<if test="language!=null and language!=''">
				<![CDATA[AND (language  &  ${language}) != 0]]> 
			</if>
			<!-- 카테고리를 선택한 경우 -->
			<if test="category!=null and category!=''">
				AND category = '${category}'
			</if>
			<!-- 서비스 상태를 선택한 경우 -->
			<if test="state!=null and state!=''">
				AND state = '${state}'
			</if>
			<if test="titlename!=null and titlename!=''">
				AND title LIKE '%${titlename}%'
			</if>
			<if test="currentPage!=null and currentPage!='' and number!=null and number!=''">
				LIMIT ${currentPage},${number}
			</if>
		</where>
	</select>
	<!-- 게시글 상세 정보 표시 -->
	<select id="RecommandDetail" parameterType="String" resultType="com.mobilpack.manager.Model.PostModel">
		SELECT category, default_language, title, admin_id, content, tag, voice_info,address,location,date,state,phone,openday,closetime,endtime
		FROM recommended_place
		WHERE postindex= '${postindex}'
	</select>
	<!-- 게시글 파일 다운로드 -->
	<select id="FileDownload" parameterType="String" resultType="com.mobilpack.manager.Model.FileModel">
		SELECT filepath FROM recommend_files
		WHERE fileindex= '${fileindex}'
	</select>
	<!-- 게시글 파일 리스트 출력 -->
	<select id="IndexOutput" parameterType="String" resultType="com.mobilpack.manager.Model.FileModel">
		SELECT * FROM recommend_files
		WHERE postindex= '${postindex}'
	</select>
	<!-- 게시글 수정 부분 -->
</mapper>